# Implementation for generating and using an **Idempotency-Key**

## ðŸ§  Overview

- âœ… Generates UUIDv4 for each logical action
- âœ… Stores key in `sessionStorage` for retry safety
- âœ… Attaches key to request header
- âœ… Clears key after success

---

## ðŸ§© 1. UUIDv4 Generator (No external libraries)

```js
function generateUUIDv4() {
  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
    (c ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))).toString(16)
  );
}
```

---

## ðŸ§± 2. Idempotency Key Manager

```js
const Idempotency = {
  prefix: "idempotencyKey_",

  generate(action) {
    const key = generateUUIDv4();
    sessionStorage.setItem(this.prefix + action, key);
    return key;
  },

  get(action) {
    return sessionStorage.getItem(this.prefix + action);
  },

  clear(action) {
    sessionStorage.removeItem(this.prefix + action);
  },
};
```

---

## ðŸš€ 3. Send Request with Idempotency-Key

```js
function sendIdempotentRequest(url, payload, action) {
  let key = Idempotency.get(action);
  if (!key) key = Idempotency.generate(action);

  fetch(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Idempotency-Key": key,
    },
    body: JSON.stringify(payload),
  })
    .then((response) => {
      if (!response.ok) throw new Error("Request failed");
      return response.json();
    })
    .then((data) => {
      console.log("Success:", data);
      Idempotency.clear(action); // Clear after success
    })
    .catch((error) => {
      console.error("Retryable error:", error);
      // Retry logic can reuse the same key
    });
}
```

---

## ðŸ§ª Example Usage

```js
const orderData = {
  productId: "ABC123",
  quantity: 2,
  userId: "user789",
};

sendIdempotentRequest("/api/orders", orderData, "createOrder");
```

---

## ðŸ§  Optional Retry Wrapper

Want to add exponential backoff or retry-on-500 logic? I can help you wrap this into a resilient client with retry thresholds and TTL logic.

Or if you're building this into a portfolio-ready gateway or SRE pattern, I can help you extend it with backend deduplication and payload hashing. Just say the word.
